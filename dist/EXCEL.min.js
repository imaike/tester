!function(e){function t(a){if(r[a])return r[a].exports;var n=r[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,a){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}({4:function(e,t){!function(e,t,r){"use strict";function a(r){var a,n,s=t.getState("language"),o=(resources[s].translation["has missing statement numbers"],resources[s].translation["has an incorrect statement number"],resources[s].translation["The number of statements in the statments sheet of the Excel file does not match the number of statements in the sorts sheet"]),i=r[0][0][1];t.setState("qavProjectName",i);var l=r[0],p=e.createMultiplierArrayAndTriangleShape(l),u=p[0],c=p[1];t.setState("qavSortTriangleShape",c),t.setState("multiplierArray",u);var S=c.length;t.setState("qavOriginalSortSize",S),t.setState("qavTotalStatements",S),t.setState("originalSortSize",S);var h=e.prepInputData(l,S),g=h.shift(),v=e.getRespondentNames(g);t.setState("qavRespondentNames",v),t.setState("respondentNames",v);var m=v.length;t.setState("qavTotalNumberSorts",m),t.setState("totalNumberSorts",m);var f=e.getRespondentSorts(h),d=f[0],x=f[1];t.setState("qavRespondentSortsFromDbStored",d);var b=_.cloneDeep(d),T=_.cloneDeep(d),D=r[1],N=e.getStatements(D);t.setState("qavCurrentStatements",N);var q=N.length,y=e.testSymmetryOfSorts(c,T,x,q);n=y[0],a=y[1];var E=[];if(0===n.length&&"true"===a){for(var P=0;P<N.length;P++){var L=N[P];$("#existingDatabaseStatementList").append("<li>"+L+"</li>")}for(var A=0;A<b.length;A++){var R=b[A],j=R.join(),w=j.replace(/,/g," ").replace(/ -/g,"-");"-"!==w.charAt(0)&&(w=" "+w),E.push(w);var M=v[A];$("#existingDatabaseRespondentList").append("<li>"+M+","+R+"</li>")}$(".jsonDownloadPQ").show()}else{$("#genericErrorModal .errorPanel").empty();for(var B=0;B<n.length;B++)$("#genericErrorModal .errorPanel").append("<p>"+v[n[B][0]]+" "+n[B][1]+"</p><br>");"false"===a&&$("#genericErrorModal .errorPanel").append("<h6>"+o+"</h6>"),VIEW.showGenericErrorModal()}t.setState("qavRespondentSortsFromDbStored",E)}function n(r){var a=t.getState("language"),n=(resources[a].translation["has missing Q-sort values"],resources[a].translation["has an incorrect Q-sort value"],resources[a].translation["Non-Symmetric Q-sorts"]),s=[],o=r[0][0][1],i=o.toString().replace(/,/g,"");t.setState("qavProjectName",i);var l=e.calcSortTriangleShapeT2(r[0][0][3]),p=l[0],u=l[1],c=l[2];t.setState("qavSortTriangleShape",c),s=e.calcMultiplierArrayT2(p),t.setState("multiplierArray",s);var S=c.length;t.setState("qavOriginalSortSize",S),t.setState("qavTotalStatements",S),t.setState("originalSortSize",S);var h=r[0][0],g=e.grabRespondentNamesAndSorts(h),v=g[0],m=g[1],f=g[2];t.setState("qavRespondentNames",v),t.setState("respondentNames",v);var d=v.length;t.setState("qavTotalNumberSorts",d),t.setState("totalNumberSorts",d);var x=m;t.setState("qavRespondentSortsFromDbStored",x);var b=r[1][0],T=e.grabProjectStatements(b);t.setState("qavCurrentStatements",T);var _=e.checkForErrors(u,f),D=_[0],N=_[1],q=[];if(0===D.length){for(var y=0;y<T.length;y++){var E=T[y];$("#existingDatabaseStatementList").append("<li>"+E+"</li>")}for(var P=0;P<x.length;P++){var L=x[P],A=L.replace(/,/g," ").replace(/ -/g,"-");"-"!==A.charAt(0)&&(A=" "+A),q.push(A);var R=v[P];$("#existingDatabaseRespondentList").append("<li>"+R+","+L+"</li>")}if(N.length>0){$("#nonSymmetricSortsDiv").append("<h4>"+n+"</h4>");for(var j=0;j<N.length;j++)$("#nonSymmetricSortsDiv").append("<p>"+v[N[j]]+", </p>")}$(".jsonDownloadPQ").show()}else{$("#genericErrorModal .errorPanel").empty();for(var w=0;w<D.length;w++)$("#genericErrorModal .errorPanel").append("<p>"+v[D[w][0]]+" "+D[w][1]+"</p><br>");VIEW.showGenericErrorModal()}t.setState("qavRespondentSortsFromDbStored",q)}function s(e){return","==e.slice(-1)&&(e=e.slice(0,-1)),e}function o(e){return e.replace(/[^a-zA-Z0-9.-]/g,function(){return""})}function i(e,t){var r=_.cloneDeep(t);return e.sort().join(",")!==r.sort().join(",")?1:0}function l(r){var a=r[0][0][0][""];t.setState("qavProjectName",a);var n=e.grabSortTriangleShapeT3(r[0][0][4][""]),s=n[0],o=n[1];t.setState("qavSortTriangleShape",s);var i=e.calcMultiplierArrayT2(o);t.setState("multiplierArray",i);var l=s.length;t.setState("qavOriginalSortSize",l),t.setState("qavTotalStatements",l),t.originalSortSize=l;var p=e.grabRespondentNamesT3(r[2]);t.setState("qavRespondentNames",p),t.setState("respondentNames",p);var u=p.length;t.setState("qavTotalNumberSorts",u),t.setState("totalNumberSorts",u);var c=e.grabSortsT3(r[2],l),S=e.grabStatementsT3(r[1][0]);t.setState("qavCurrentStatements",S);var h=(_.cloneDeep(c),[]),g=[];if(0===h.length){for(var v=0;v<S.length;v++){var m=S[v];$("#existingDatabaseStatementList").append("<li>"+m+"</li>")}for(var f=0;f<c.length;f++){var d=c[f],x=d.join(),b=x.replace(/,/g," ").replace(/ -/g,"-");"-"!==b.charAt(0)&&(b=" "+b),g.push(b);var T=p[f];$("#existingDatabaseRespondentList").append("<li>"+T+","+d+"</li>")}$(".jsonDownloadPQ").show()}t.setState("qavRespondentSortsFromDbStored",g)}e.exportExcelSortsPQM=function(){var e=[];$("#existingDatabaseRespondentList li").each(function(){var t=$(this).text();e.push(t)});var r,a,n,s,o,i;r=e.length,a=String(UTIL.threeDigitPadding(r)),n=t.getState("qavProjectName");for(var l=t.getState("qavSortTriangleShape"),p=_.min(l),u=_.max(l),c=String(UTIL.threeDigitPadding(+p)),S=String(UTIL.threeDigitPadding(+u)),h=t.getState("multiplierArray"),g="",v="",m=0;m<20;m++)g=String(UTIL.threeDigitPadding(h[m])),v+=g;s=t.getState("qavCurrentStatements"),o=0===s.length?l.length:s.length,i=String(UTIL.threeDigitPadding(o));var f=c+S+v;$("#excelSortExportBox").append("  0"+a+i+" "+n),$("#excelSortExportBox").append("\n"),$("#excelSortExportBox").append(f),$("#excelSortExportBox").append("\n");for(var d=0;d<e.length;d++){var x=e[d].split(","),b=x[0],T=INPUT.sanitizeRespondentName(b),D=x.slice(1,x.length),N=D.toString();"sort"===N.slice(-4)&&(N=N.replace(/delete sort/g,""));var q=N.replace(/,/g," "),y=q.replace(/ -/g,"-"),E=y.replace(/[\[\]']+/g,"");E=+x[1]<0?"  "+E:"   "+E;var P=T+E;$("#excelSortExportBox").append(P),$("#excelSortExportBox").append("\n")}var L=$("#excelSortExportBox").val(),A=UTIL.currentDate1()+"-"+UTIL.currentTime1(),R=new Blob([L],{type:"text/plain;charset=us-ascii"});saveAs(R,"Ken-Q_PQMethod_Export_"+A+".DAT"),$("#excelSortExportBox").html("")},e.exportStatementsToPqmethod=function(){for(var e=t.getState("qavCurrentStatements"),r=$("#excelSortExportBox"),a=0;a<e.length;a++)r.append(e[a],"\n");var n=r.val(),s=UTIL.currentDate1()+"-"+UTIL.currentTime1(),o=new Blob([n],{type:"text/plain;charset=us-ascii"});saveAs(o,"Ken-Q_PQMethod_Statements_"+s+".STA"),$("#excelSortExportBox").html("")},e.filePicked=function(e){var r,s,o,i,l,p,u,c,S=t.getState("typeOfExcelFile"),h=e.target.files[0],g=new FileReader,v=[],m=[];g.onload=function(e){l=e.target.result,p=XLSX.read(l,{type:"binary"}),c=p.SheetNames,c.forEach(function(e){if(u=p.Sheets[e],"sorts"===e)if(r=XLSX.utils.sheet_to_csv(u),s=r.split(/\n/),"user-input"===S)for(var t=1;t<100;t++)o=s[t].split(","),v.push(o);else"unforced"===S&&(o=s.filter(Boolean),v.push(o));else"statements"===e&&(v=[],i=XLSX.utils.sheet_to_json(u),v.push(i));m.push(v)}),"user-input"===S?a(m):"unforced"===S&&n(m)},g.readAsBinaryString(h)},e.filePickedKenq=function(e){var r=t.getState("language"),a=resources[r].translation["Project Overview"],n=resources[r].translation.Statements,s=e.target.files[0],o=new FileReader;o.onload=function(e){var t=e.target.result,r=XLSX.read(t,{type:"binary"}),s=[];r.SheetNames.forEach(function(e){var t,o=r.Sheets[e];if(e===a){t=[];var i=XLSX.utils.sheet_to_json(o);t.push(i)}else if("Q-sorts"===e){var l=XLSX.utils.sheet_to_csv(o),p=l.split(/\n/);t=[],p.forEach(function(e){var r=e.split(",");t.push(r)})}else if(e===n){t=[];var u=XLSX.utils.sheet_to_json(o);t.push(u)}s.push(t)}),l(s)},o.readAsBinaryString(s)},e.testSymmetryOfSorts=function(e,r,a,n){for(var s,o,l,p=t.getState("language"),u=resources[p].translation["has missing statement numbers"],c=resources[p].translation["has an incorrect Q-sort value"],S=_.cloneDeep(e),h=[],g=d3.range(1,S.length+1),v=_.max(g),m=_.min(g),f=0;f<r.length;f++)l=_.max(a[f]),o=_.min(a[f]),l>v||o<m?h.push([f,c]):i(a[f],g)>0&&h.push([f,u]);s=n!==S.length?"false":"true";return[h,s]},e.getStatements=function(e){for(var t=[],r=0,a=e[0].length;r<a;r++){var n=e[0][r].Statements;""===n||void 0===n||null===n||t.push(n)}return t},e.getRespondentSorts=function(e){for(var t=_.zip.apply(_,e),r=[],a=0;a<t.length;a++){var n=_.sortBy(t[a],function(e){return e.statementNum});r.push(n)}for(var s,o,i=[],l=[],p=0;p<r.length;p++){for(var u=r[p],c=[],S=[],h=0;h<u.length;h++)s=u[h].sortValue,o=u[h].statementNum,c.push(s),S.push(o);l.push(c),i.push(S)}return[l,i]},e.getRespondentNames=function(e){for(var t=[],r=0,a=e.length;r<a;r++){var n=e[r].statementNum;""!==n&&t.push(n)}return t=UTIL.checkUniqueName(t)},e.prepInputData=function(e,t){for(var r=[],a=29+t,n=e[28].length-1,s=28;s<a;s++){for(var o,i,l=e[s][0],p=[],u=1,c=0;c<n;c++)o=e[s][u],28===s&&""!==o?(i={},i.sortValue=l,i.statementNum=o,p.push(i)):""!==o&&(i={},i.sortValue=+l,i.statementNum=+o,p.push(i)),u+=1;r.push(p)}return r},e.createMultiplierArrayAndTriangleShape=function(e){for(var t=[],r=[],a=4;a<24;a++){var n=+e[a][1];if(n<1||isNaN(n))r.push(0);else{var s=+e[a][1];r.push(s);for(var o=+e[a][0],i=0,l=s;i<l;i++)t.push(o)}}return[r,t]},e.checkForErrors=function(e,r){for(var a,n,s=t.getState("language"),o=resources[s].translation["has missing statement numbers"],l=resources[s].translation["has an incorrect statement number"],p=[],u=[],c=_.max(e),S=_.min(e),h=e.length,g=0,v=r.length;g<v;g++)r[g].length!==h&&p.push([g,o]),n=_.max(r[g]),a=_.min(r[g]),(n>c||a<S)&&p.push([g,l]),i(r[g],e)>0&&u.push(g);return[p,u]},e.grabProjectStatements=function(e){for(var t=[],r=0,a=e.length;r<a;r++){var n=e[r].Statements;""===n||void 0===n||null===n||t.push(n)}return t},e.grabRespondentNamesAndSorts=function(e){for(var t=[],r=[],a=[],n=[],o=6;o<e.length;o++){var i=e[o].toString().replace(/,,/g,"");if(i.length<5)break;a.push(i),i=s(i);var l=i.split(","),p=l.shift(),u=l.toString();r.push(p),n.push(u),t.push(l)}return[r,n,t]},e.calcMultiplierArrayT2=function(e){for(var t,r=[],a=0,n=e.length;a<n;a++)e[a]!==t?r.push(1):r[r.length-1]++,t=e[a];for(var s=e[0],o=Math.abs(-6-s),i=0;i<o;i++)r.unshift(0);for(var l=0;l<20;l++)r.length<20&&r.push(0);return r},e.calcSortTriangleShapeT2=function(e){var t=e.replace(/,,/g,"");t=s(t);var r=t.replace(/Sort Pattern,/,""),a=r.split(",");for(var n in a)a[n]=parseInt(a[n],10);return[_.cloneDeep(a),_.cloneDeep(a),_.cloneDeep(a)]},e.grabStatementsT3=function(e){for(var t=[],r=1;r<e.length;r++){var a=e[r][""];""===a||void 0===a||null===a||t.push(a)}return t},e.grabSortsT3=function(e,t){for(var r=[],a=4;a<e.length;a++){var n=[],s=e[a][1];if(""===s||null===s||void 0===s);else{var i=e[a][1],l=o(i);n.push(+l);for(var p=t,u=2;u<p;u++){var c=e[a][u];n.push(+c)}var S=e[a][p],h=o(S);n.push(+h),r.push(n)}}return r},e.grabRespondentNamesT3=function(e){for(var t=[],r=1,a=e.length;r<a;r++){var n=e[r][0];""===n||t.push(n)}return t.slice(2)},e.grabSortTriangleShapeT3=function(e){var t=JSON.parse("["+e+"]"),r=_.cloneDeep(t);return[t,r]}}(window.EXCEL=window.EXCEL||{},QAV)}});